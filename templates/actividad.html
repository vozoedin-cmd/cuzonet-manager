<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Actividad - CuzoNet Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="bg-animation">
        <div class="bg-gradient"></div>
        <div class="bg-grid"></div>
        <div class="floating-orbs">
            <div class="orb orb-1"></div>
            <div class="orb orb-2"></div>
            <div class="orb orb-3"></div>
        </div>
    </div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-network-wired"></i>
                <span>CuzoNet</span>
            </div>
            <p class="logo-subtitle">MikroTik Manager</p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/" class="nav-link"><i class="fas fa-home"></i><span>Dashboard</span></a>
            </li>
            <li class="nav-item">
                <a href="/clientes" class="nav-link"><i class="fas fa-users"></i><span>Clientes</span></a>
            </li>
            <li class="nav-item">
                <a href="/pagos" class="nav-link"><i class="fas fa-money-bill-wave"></i><span>Pagos</span></a>
            </li>
            <li class="nav-item">
                <a href="/reportes" class="nav-link"><i class="fas fa-chart-bar"></i><span>Reportes</span></a>
            </li>
            <li class="nav-item">
                <a href="/configuracion" class="nav-link"><i class="fas fa-cog"></i><span>Configuracion</span></a>
            </li>
            <li class="nav-item">
                <a href="/mapa" class="nav-link"><i class="fas fa-map-marked-alt"></i><span>Mapa</span></a>
            </li>
            <li class="nav-item">
                <a href="/monitor" class="nav-link"><i class="fas fa-tachometer-alt"></i><span>Monitor</span></a>
            </li>
            <li class="nav-item active">
                <a href="/actividad" class="nav-link"><i class="fas fa-history"></i><span>Actividad</span></a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div class="theme-toggle" onclick="toggleTheme()" style="display:flex;align-items:center;gap:10px;padding:10px 16px;cursor:pointer;color:var(--text-secondary);border-radius:var(--radius-md);transition:all .2s;" onmouseover="this.style.background='rgba(14,165,233,0.1)'" onmouseout="this.style.background='transparent'">
                <i class="fas fa-moon" id="themeIcon"></i>
                <span id="themeText">Modo Claro</span>
            </div>
            <div class="mikrotik-status" id="mikrotikStatus">
                <div class="status-indicator offline"></div>
                <span>MikroTik: Verificando...</span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-history"></i> Registro de Actividad</h1>
                <p class="header-subtitle">Historial de acciones del sistema</p>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchAudit" placeholder="Buscar actividad..." onkeyup="filtrarActividad()">
                </div>
            </div>
        </header>

        <section class="table-section">
            <div class="table-container">
                <table class="data-table" id="auditTable">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Usuario</th>
                            <th>Acción</th>
                            <th>Entidad</th>
                            <th>Detalle</th>
                            <th>IP Origen</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td>
                                <span style="color: var(--text-muted); font-size: 0.85rem;">
                                    {{ log.fecha.strftime('%d/%m/%Y %H:%M') if log.fecha else '—' }}
                                </span>
                            </td>
                            <td>
                                <span style="font-weight: 500;">{{ log.usuario }}</span>
                            </td>
                            <td>
                                {% if log.accion == 'login' %}
                                <span class="status-badge active" style="font-size: 0.75rem;"><i class="fas fa-sign-in-alt"></i> Login</span>
                                {% elif log.accion == 'eliminar' %}
                                <span class="status-badge" style="background:rgba(239,68,68,0.2);color:#ef4444;border:1px solid rgba(239,68,68,0.3);font-size:0.75rem;"><i class="fas fa-trash"></i> Eliminar</span>
                                {% elif log.accion == 'pago' %}
                                <span class="status-badge" style="background:rgba(16,185,129,0.2);color:#10b981;border:1px solid rgba(16,185,129,0.3);font-size:0.75rem;"><i class="fas fa-dollar-sign"></i> Pago</span>
                                {% elif log.accion == 'editar' %}
                                <span class="status-badge" style="background:rgba(14,165,233,0.2);color:#0ea5e9;border:1px solid rgba(14,165,233,0.3);font-size:0.75rem;"><i class="fas fa-edit"></i> Editar</span>
                                {% elif log.accion == 'crear' %}
                                <span class="status-badge" style="background:rgba(6,182,212,0.2);color:#06b6d4;border:1px solid rgba(6,182,212,0.3);font-size:0.75rem;"><i class="fas fa-plus"></i> Crear</span>
                                {% elif log.accion == 'corte' %}
                                <span class="status-badge" style="background:rgba(245,158,11,0.2);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);font-size:0.75rem;"><i class="fas fa-ban"></i> Corte</span>
                                {% else %}
                                <span class="status-badge" style="background:rgba(100,116,139,0.2);color:#94a3b8;border:1px solid rgba(100,116,139,0.3);font-size:0.75rem;">{{ log.accion }}</span>
                                {% endif %}
                            </td>
                            <td style="text-transform: capitalize;">{{ log.entidad or '—' }}</td>
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ log.detalle or '' }}">{{ log.detalle or '—' }}</td>
                            <td style="font-family: monospace; font-size: 0.85rem; color: var(--text-muted);">{{ log.ip_origen or '—' }}</td>
                        </tr>
                        {% endfor %}
                        {% if not logs %}
                        <tr>
                            <td colspan="6" class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>No hay registros de actividad</p>
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <div class="toast-container" id="toastContainer"></div>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        function filtrarActividad() {
            const search = document.getElementById('searchAudit').value.toLowerCase();
            const rows = document.querySelectorAll('#auditTable tbody tr');
            rows.forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(search) ? '' : 'none';
            });
        }

        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            document.getElementById('themeIcon').className = isLight ? 'fas fa-sun' : 'fas fa-moon';
            document.getElementById('themeText').textContent = isLight ? 'Modo Oscuro' : 'Modo Claro';
        }
        (function() { if (localStorage.getItem('theme') === 'light') { document.body.classList.add('light-mode'); document.getElementById('themeIcon').className='fas fa-sun'; document.getElementById('themeText').textContent='Modo Oscuro'; } })();
    </script>
</body>

</html>
